---
title: "Tablas de contingencia"
---

```{r include=FALSE}
source("00_datos/source.R")
```

## 1. En R

Permite conocer la relaci√≥n existente entre variables categ√≥ricas. Para ello nos valemos de las tablas de contingencia, donde se muestran las frecuencias de dos variables.

### La funci√≥n table

1.  Crear la tabla con las dos variables y guardarla:

``` r
tabla <- table(datos$var1, datos$var2)
```

Ej.:

```{r}
tabla <- table(datos$situ_lab, datos$hombre)  # (filas, columnas)
tabla
```

*La primera variable son las filas de la tabla y la segunda las columnas. La variable con menos categor√≠as se pone en las columnas porque as√≠ es m√°s sencillo de visualizar e interpretar, creando una tabla que se extiende de forma vertical en lugar de horizontal (mejor la primera tabla que la segunda).*

2.  Crear la tabla de frecuencias:

-   `prop.table(tabla)` Porcentaje de tabla (el % sobre el total)
-   `prop.table(tabla, 1)` Porcentajes de fila (el 100% lo suman las filas)
-   `prop.table(tabla, 2)` Porcentajes de columna (el 100% lo suman las columnas) Para leer estas tablas adecuadamente, hay que fijarse si el 100% lo suman las filas, las columnas o toda la tabla.

Ej.:

```{r}
prop.table(tabla)   
```

Indica el porcentaje de cada subgrupo sobre el total de la muestra. Por ejemplo, de esta tabla se puede deducir que del total de la poblaci√≥n un 25% son mujeres trabajadoras.

```{r}
prop.table(tabla, 1)
```

Indica la composici√≥n de g√©nero de cada una de las situaciones laborales. Por ejemplo, de los trabajadores un 44% son mujeres y un 56% hombres.

```{r}
prop.table(tabla, 2)
```

Indica el perfil laboral dentro de cada g√©nero. Por ejemplo, un 54% de las mujeres son trabajadoras, mientras que un 63% de los hombres son trabajadores.

### Otras tablas

Otros dos comandos para realizar tablas de contingencia son `xtabls`y `CrossTable`. Estos comandos resultan m√°s √∫tiles cuando, a parte de las frecuencias y los porcentajes, se quieren conocer tambi√©n otros estad√≠sticos como el Chi^2^ o los residuos.

**Es mejor usar la funci√≥n `CrossTable`.**

::: {.panel-tabset}

#### `CrossTable()`

``` r
library(gmodels)
tabla3 <- CrossTable(datos$var1, datos$var2, #Las variables
                     digits = 1, #El n√∫mero de decimales de la tabla
                     #Otras opciones de la tabla,
                     format = "SPSS") #El formato de salida de la tabla
```

```{r include=FALSE}
library(gmodels)
```

Ej.:

```{r}
CrossTable(datos$situ_lab, datos$hombre, digits=1, expected=T, asresid=TRUE, chisq=TRUE, prop.chisq=F, format="SPSS")
```

*Para comprobar qu√© opciones se pueden aplicar a la tabla, conviene mirar `?(CrossTable)`*

Ej. de interpretaci√≥n de los residuos ajustados: en la celda de mujer y trabajadoras, los residuos ajustados son de -17,9. Esta cifra es inferior a -3,27, por lo que podemos decir que con un nivel de confianza del 99,9% las mujeres se encuentran infrarepresentadas (el s√≠mbolo es negativo) dentro del grupo de los trabajadores.

#### `xtabs()`

``` r
tabla2 <- xtabs(~var1+var2, data = datos) #Crear y guardar la tabla
ftable(tabla2) #Visualizar la tabla
summary(tabla2) #Para ver los estad√≠sticos de la tabla (como el chi2 y el p-valor)
```

Ej.:

```{r}
tabla2 <- xtabs(~situ_lab+hombre, data=datos)
ftable(tabla2) 
summary(tabla2) 
```


:::

------------------------------------------------------------------------

## 2. Teor√≠a

Las hip√≥tesis a comprobar en una tabla de contingencia son:

-   H~0~= no existe asociaci√≥n entre las variables (son independientes)
-   H~1~= s√≠ existe asociaci√≥n entre las variables

Para saber si existe relaci√≥n entre las variables debemos fijarnos en:

### El an√°lisis de los residuos

A la hora de examinar la asociaci√≥n entre variable categ√≥ricas es importante diferenciar entre:

-   Frecuencia observada: la frecuencia en la muestra
-   Frecuencia esperada: la frecuencia que observar√≠amos en el caso de que **no hubiera relaci√≥n entre las 2 variables**
-   Residuo: diferencia entre el valor observado y el esperado, que manifiesta dependencia entre pares de valores cuando es distinto de cero. Cuanto mayor sea el residuo, mayor ser√° la probabilidad de que la muestra provenga de una poblaci√≥n en la que las variables est√©n relacionadas. Para determinar si el valor de los residuos es significativo, es necesario estandarizarlos.

Si el residuo ajustado es mayor (en t√©rminos absolutos) que el valor cr√≠tico para un determinado nivel de confianza (1,96 para el 95%), se puede decir que la diferencia entre los valores esperados y los ajustados para una celda concreta de la tabla es significativa. En funci√≥n de si el signo de estos residuos es positivo o negativo, sabremos si la relaci√≥n establecida en la celda es de sobrerrepresentaci√≥n dentro de la muestra (signo +) o de infrarrepresentaci√≥n (signo -). *(Hay un ejemplo de esto al final de la explicaci√≥n de CrossTables en R)*

### Chi2

El chi-cuadrado (œá¬≤) es una prueba estad√≠stica que se utiliza para comparar frecuencias observadas con frecuencias esperadas, a fin de determinar si hay una diferencia significativa entre ellas. Se emplea com√∫nmente para analizar tablas de contingencia y evaluar si dos variables categ√≥ricas est√°n relacionadas. Elùúí2 se define como:

$$\chi^2 = \sum \frac {(O - E)^2}{E}$$ Donde:

-   O = Frecuencias observadas
-   E = Frecuencias esperadas

Por ser suma de cuadrados, se cumple que ùúí2‚â•0:

-   ùúí2=0 cuando las variables son independientes
-   ùúí2 crece a medida que aumenta la dependencia entre las variables

Sabemos que el valor de chi-cuadrado (œá¬≤) es lo suficientemente alto para ser significativo compar√°ndolo con un valor cr√≠tico de una tabla de chi-cuadrado, o mediante su p-valor.

------------------------------------------------------------------------
